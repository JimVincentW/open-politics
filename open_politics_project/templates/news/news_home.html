{% extends "base.html" %}

{% load static %}

{% block news_home %}
{% if user.is_authenticated %}
<div class='max-w-xl mx-auto p-4 sm:p-8'>
    <div class='text-center'>
        <h1 class='text-gray-700 dark:text-gray-200 text-2xl font-bold mb-6'>TLDR Summary Generator</h1>
    </div>
    <div class='w-full'>
        <!-- Begin Form -->
        <form hx-get="{% url 'fetch_tldr' %}" hx-target="#tldr-container" class="flex flex-col space-y-4">
            <input type="text" name="query" placeholder="Search..." class="border border-gray-300 p-2 rounded-lg focus:ring focus:ring-blue-300">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Fetch TLDR
            </button>
        </form>
        <!-- Spinner -->
        <div class="spinner hidden fixed inset-0 z-50 flex justify-center items-center">
            <div class="animate-spin rounded-full h-32 w-32 border-t-4 border-b-4 border-blue-500"></div>
        </div>
        <!-- TLDR Output -->
        <div id="tldr-output" class="bg-blue-100 text-blue-900 p-6 rounded-lg shadow-lg max-h-96 overflow-y-auto mt-4">
            {{ tldr|safe }}
        </div>
    </div>
</div>
<script src="https://unpkg.com/htmx.org"></script>
{% else %}
<div class='max-w-xl mx-auto p-4 sm:p-8 flex flex-col justify-center items-center'>
    <div class='text-center'>
        <h1 class='text-gray-700 dark:text-gray-200 text-2xl font-bold mb-6'>TLDR Summary Generator</h1>
        <h2 class='text-gray-700 dark:text-gray-200'>Sign in to use the TLDR Summary Generator</h2>
    </div>
</div>
{% endif %}
<script>
    document.body.addEventListener('htmx:afterRequest', function() {
        document.querySelector('.spinner').style.display = 'none';
    });

    document.body.addEventListener('htmx:beforeRequest', function() {
        document.querySelector('.spinner').style.display = 'flex';
    });
</script>
{% endblock %}
