{% extends "base.html" %}
{% load static %}
{% block news_home %}
<style>
    /* Base styling */
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f7f7f7;
    }

    /* Container layout */
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: start;
        height: 100vh;
        background-image: url('https://source.unsplash.com/jQAk1lZL5Jk');
        background-size: cover;
        background-position: center;
    }

    /* Glassy card effect */
    .glass-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 2rem;
        margin: 1rem 0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    /* Search container styles */
    .search-container {
        max-width: 600px;
        width: 100%;
        padding: 1rem;
        text-align: center;
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        margin-top: 4em;
    }

    /* Form styles */
    form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    input[type="text"] {
        padding: 0.5rem;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }

    #loading {
        display: none;
    }

    /* Results container */
    #results {
        margin-top: 1rem;
        max-height: 500px;
        overflow-y: scroll;
        border-radius: 20px;
        padding: 2rem;
    }

    .search-title {
        text-align: center;
        color: white;
        margin-top: 2em;
        padding-bottom: 1rem;
        font-size: x-large;
    }

    h3 {
        margin: 0;
    }


    #news-results, #actors-results {
    margin-bottom: 1.5rem;
    text-align: left;
    }

    #news-results h4, #actors-results h4 {
        font-size: 1.4rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid rgba(255, 255, 255, 0.5);
        padding-bottom: 0.5rem;
    }

    #news-results ul, #actors-results ul {
        list-style: disc;
        padding-left: 20px;
    }

    #news-results li, #actors-results li {
        margin-bottom: 0.5rem;
    }

    .giphy-embed {
    border-radius: 500px;
    margin: 0 auto;
    display: block;
    max-width: 100%; /* ensures the image doesn't exceed its container's width */
    }

    .loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    color: white;
    height: 100%;    /* Add this */
    width: 100%;     /* Add this */
    }
</style>
<div class="container">
    <div class="search-title">
        <h3>Search News and Actors</h3>
    </div>

    <div class="search-container">
        <form id="search-form">
            <input type="text" name="query" placeholder="Search...">
            <div class="loading" id="loading" style="display: none;">
                <div style="width: auto">
                    <img src="{% static 'media/spinner.gif' %}" width="auto" height="480" frameborder="0" class="giphy-embed" allowfullscreen></img>
                </div>
                <div style="margin-top: 20px; color: black; font-weight: bold;">
                    Thinking...
                </div>

            </div>
        </form>
        <div id="results" class="glass-card">
            <div id="news-results"></div>
            <div id="actors-results"></div>
        </div>
    </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.0/marked.min.js" integrity="sha512-4+zFvAejSGVlybiAKYyAz3KMjmbIT7I+wXgx190ZAsT19L2z8S4htBy1scR7CyP9pDKNSaolJMLedCigA/gFVg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        let timer;
        const loadingSpinner = document.getElementById('loading');

        // Helper function to show and hide the loading spinner
        function showLoadingSpinner() {
            loadingSpinner.style.display = 'block';
        }

        function hideLoadingSpinner() {
            loadingSpinner.style.display = 'none';
        }

        // Helper function to render markdown content
        function renderMarkdown(contentId) {
            const content = document.getElementById(contentId);
            content.innerHTML = marked.parse(content.textContent);  // Use marked.parse() here
        }

        // Listener for search form
        document.getElementById('search-form').querySelector('input[name="query"]').addEventListener('input', function() {
            clearTimeout(timer);
            timer = setTimeout(async function() {
                showLoadingSpinner(); // Show spinner when fetching data

                let queryValue = encodeURIComponent(document.getElementById('search-form').querySelector('input[name="query"]').value);
                
                // Fetch news results
                let newsResponse = await fetch('/news_synopsis/?query=' + queryValue);
                if (newsResponse.ok) {
                    let newsHTML = await newsResponse.text();
                    document.getElementById('news-results').innerHTML = newsHTML;
                    renderMarkdown('synopsis-content');  // Parse and render markdown for synopsis
                }

                // Fetch actors results
                let actorsResponse = await fetch('/news_actors/?query=' + queryValue);
                if (actorsResponse.ok) {
                    let actorsHTML = await actorsResponse.text();
                    document.getElementById('actors-results').innerHTML = actorsHTML;
                    renderMarkdown('actors-content');  // Parse and render markdown for actors
                }
                
                hideLoadingSpinner(); // Hide spinner when data is loaded
            }, 500);
        });
    });
</script>

{% endblock %}