{% extends 'base.html' %}

{% block content %}
<form method="post" id="login-form" class="max-w-md mx-auto mt-10 bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden md:max-w-2xl">
    {% csrf_token %}
    <div class="p-8">
        <div class="mb-4">
            <label for="username" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Username:</label>
            <input type="text" name="username" id="username" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-300 leading-tight focus:outline-none focus:shadow-outline">
        </div>
        <div class="mb-6">
            <label for="password" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Password:</label>
            <input type="password" name="password" id="password" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:text-gray-300 mb-3 leading-tight focus:outline-none focus:shadow-outline">
        </div>
        <div class="flex items-center justify-between">
            <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none border-blue-500 hover:border-blue-700">
                Login
            </button>
        </div>
    </div>
</form>

<script>
    document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
    
        var formData = new FormData(this);
        var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
        fetch('/login/', {
            method: 'POST',
            body: formData,
            headers: {
                "X-CSRFToken": csrftoken
            },
        })
        .then(response => response.json())
        .then(data => {
            if(data.token) {
                sessionStorage.setItem('authToken', data.token);
                window.location.href = '/'; // Redirect to the homepage
            } else {
                alert('Login failed');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>
{% endblock %}
